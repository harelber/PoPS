# PoPS
This repository is the implementation of "POPS: From History to Mitigation of DNS Cache Poisoning Attacks", to be presented in Usenix Security 25'.

POPS (POisoning Prevention System) is a lightweight, modular DNS cache poisoning defense designed for integration into Intrusion Prevention Systems (IPS). It detects statistical DNS poisoning attacks using three simple rules and mitigates them via the TC flag. 

## üìÅ File Structure

| File | Description |
|------|-------------|
| `main.go` | Core logic: reads packets, filters, batches, and enforces all rules |
| `cms_rule.go` | Implements Count-Min Sketch logic for statistical attacks and fragmentation attack detection |
| `bailiwick_rule.go` | Implements deteciton of out-of-bailiwick attacks |
| `runner.py` | Runs PoPS with a pcap file, to detect malicious activity |
| `analyzer.py` | Analyzes the results of `runner.py` |
| `generators` | Folder of sample scripts to generate pcaps |
| `attack_pcaps` | Folder of generated pcaps, from known attacks |

## üì¶ Dataset Access
Due to GitHub‚Äôs file size limitations, the benign DNS traffic dataset used in this study is too large to host here.
You can download it directly from Mendeley Data:

‚û° https://data.mendeley.com/datasets/c4n7fckkz3/3

Place the .pcap files as a folder in the project directory and reference them using the -base flag when running `runner.py`.

## ‚öôÔ∏è Installation

```bash
git clone https://github.com/harelber/PoPS.git
cd PoPS
go mod tidy
go build
```


Install Python dependencies (required for running experiment scripts):
```bash
pip install -r requirements.txt
```

## üèÉ Running Experiments

### runner.py

This script automates running PoPS on multiple `.pcap` files with different Count-Min Sketch (CMS) parameters.

**Usage:**
```bash
python runner.py --base <pcap_folder> --output <output_folder> --ip <ip_address>
```

**Arguments:**
- `--base` (required): Path to the folder containing `.pcap` files (or subfolders).
- `--output` (required): Directory where output and error logs will be saved.
- `--ip` (required): IP address of the target resolver.

The script iterates over preset CMS parameters (`w` and `d` values), processes each `.pcap` file, and saves the results in the specified output directory.

---

### analyzer.py

This script analyzes the output files generated by `runner.py` to evaluate detection performance.

**Usage:**
```bash
python analyzer.py --mode <mal|ben> --folder <results_folder> --noise <noise_value>
```

**Arguments:**
- `--mode` (required): Type of analysis. Use `mal` for malicious traffic or `ben` for benign traffic.
- `--folder` (required): Path to the folder containing result `.txt` files (output from `runner.py`).
- `--noise` (required): The amount of added noise (integer, e.g., 0, 100, 200, 500).

The script summarizes detection results, reporting statistics such as false positives and detection success rates.

---

## üìö Citation
If you use this tool or reference it in academic work, please cite the following paper:
```
@article{afek2025pops,
  title     = {POPS: From History to Mitigation of DNS Cache Poisoning Attacks},
  author    = {Afek, Yehuda and Berger, Harel and Bremler-Barr, Anat},
  journal   = {arXiv preprint arXiv:2501.13540},
  year      = {2025},
  url       = {https://arxiv.org/abs/2501.13540}
}
```
