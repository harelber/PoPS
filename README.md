# PoPS
This repository is the implementation of "POPS: From History to Mitigation of DNS Cache Poisoning Attacks", to be presented in Usenix Security 25'.

POPS (POisoning Prevention System) is a lightweight, modular DNS cache poisoning defense designed for integration into Intrusion Prevention Systems (IPS). It detects statistical DNS poisoning attacks using three simple rules and mitigates them via the TC flag. 

## üìÅ File Structure

| File | Description |
|------|-------------|
| `main.go` | Core logic: reads packets, filters, batches, and enforces all rules |
| `cms_rule.go` | Implements Count-Min Sketch logic for statistical attacks and fragmentation attack detection |
| `bailiwick_rule.go` | Implements deteciton of out-of-bailiwick attacks |
| `runner.py` | Runs PoPS with a pcap file, to detect malicious activity |
| `analyzer.py` | Analyzes the results of `runner.py` |
| `generators` | Folder of sample scripts to generate pcaps |
| `attack_pcaps` | Folder of generated pcaps, from known attacks |

## üì¶ Dataset Access
Due to GitHub‚Äôs file size limitations, the benign DNS traffic dataset used in this study is too large to host here.
You can download it directly from Mendeley Data:

‚û° https://data.mendeley.com/datasets/c4n7fckkz3/3

Place the .pcap files as a folder in the project directory and reference them using the -base flag when running `runner.py`.

## ‚öôÔ∏è Installation

```bash
git clone https://github.com/harelber/PoPS.git
cd PoPS
go mod tidy
go build
```


Install Python dependencies (required for running experiment scripts):
```bash
pip install -r requirements.txt
```

## üèÉ Running Experiments

### runner.py

This script automates running PoPS on multiple `.pcap` files with different Count-Min Sketch (CMS) parameters (`w` and `d`), processes each `.pcap` file, and saves the results in the specified output directory.

**Usage:**
```bash
python runner.py --base <pcap_folder> --output <output_folder> --ip <ip_address>
```

**Arguments:**
- `--base` (required): Path to the folder containing `.pcap` files (or subfolders).
- `--output` (required): Directory where output and error logs will be saved.
- `--ip` (required): IP address of the target resolver.


---

### analyzer.py

This script analyzes the output files generated by `runner.py` to evaluate detection performance.

**Usage:**
```bash
python analyzer.py --mode <mal|ben> --folder <results_folder> --noise <noise_value>
```

**Arguments:**
- `--mode` (required): Type of analysis. Use `mal` for malicious traffic or `ben` for benign traffic.
- `--folder` (required): Path to the folder containing result `.txt` files (output from `runner.py`).
- `--noise` (required): The amount of added noise (integer, e.g., 0, 100, 200, 500).

#### Understanding the Analysis Output

- **Malicious Mode (`--mode mal`):**
  - Use this mode when analyzing results from attack pcaps (i.e., pcaps where a DNS poisoning attack was attempted).
  - The output table includes:
    - **Success**: The attacker's success rate, calculated as the fraction of attack packets that were *not* detected and blocked. Lower values indicate better defense.
    - **FP**: The false positive rate, representing the fraction of benign packets incorrectly flagged as malicious.

- **Benign Mode (`--mode ben`):**
  - Use this mode for completely benign traffic (no attacks present).
  - The output table includes:
    - **Total_Benign**: The total number of packets in the benign pcap.
    - **Malicious_Found**: The number of benign packets incorrectly flagged as malicious.
    - **FP**: The false positive rate, calculated as the ratio of `Malicious_Found` to `Total_Benign`.

These metrics help you evaluate both the effectiveness of PoPS in blocking attacks and its accuracy in avoiding false positives on clean traffic.

---

## üìö Citation
If you use this tool or reference it in academic work, please cite the following paper:
```
@inproceedings{afek2025pops,
  title     = {POPS: From History to Mitigation of DNS Cache Poisoning Attacks},
  author    = {Afek, Yehuda and Berger, Harel and Bremler-Barr, Anat},
  booktitle = {Proceedings of the 34th USENIX Security Symposium},
  year      = {2025},
  url       = {https://www.usenix.org/conference/usenixsecurity25}
}
```
